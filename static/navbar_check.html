<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¼èˆªèœå•è¯Šæ–­</title>
    <link href="{{ url_for('static', filename='libs/bootstrap/css/bootstrap.min.css') }}" rel="stylesheet">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid;
        }
        .success { background: #d4edda; border-color: #28a745; }
        .error { background: #f8d7da; border-color: #dc3545; }
        .warning { background: #fff3cd; border-color: #ffc107; }
        .info { background: #d1ecf1; border-color: #17a2b8; }
        .code {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>å¯¼èˆªèœå•è¯Šæ–­å·¥å…·</h1>
    <p>æ­¤é¡µé¢ç”¨äºè¯Šæ–­å¯¼èˆªèœå•ä½ç½®äº’æ¢çš„é—®é¢˜ã€‚</p>

    <div class="test-result info">
        <h3>æ­¥éª¤ 1ï¼šæ¸…é™¤æµè§ˆå™¨ç¼“å­˜</h3>
        <p>é¦–å…ˆå°è¯•æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼š</p>
        <ul>
            <li>Windows: <code>Ctrl + Shift + Delete</code></li>
            <li>Mac: <code>Cmd + Option + E</code></li>
            <li>å¼ºåˆ¶åˆ·æ–°: <code>Ctrl + F5</code> (Windows) æˆ– <code>Cmd + Shift + R</code> (Mac)</li>
        </ul>
    </div>

    <div id="currentOrder" class="test-result warning">
        <h3>æ­¥éª¤ 2ï¼šæ£€æŸ¥å½“å‰å¯¼èˆªèœå•é¡ºåº</h3>
        <p>å½“å‰é¡µé¢çš„å¯¼èˆªèœå•é¡ºåºï¼š</p>
        <ul id="navOrderList"></ul>
    </div>

    <div id="expectedOrder" class="test-success">
        <h3>æ­¥éª¤ 3ï¼šæ­£ç¡®çš„å¯¼èˆªèœå•é¡ºåº</h3>
        <p>æ‰€æœ‰é¡µé¢åº”è¯¥ä½¿ç”¨ä»¥ä¸‹é¡ºåºï¼š</p>
        <ol>
            <li>é¦–é¡µ <i class="fas fa-home"></i></li>
            <li>èµ„æºæ¦‚è§ˆ <i class="fas fa-chart-line"></i></li>
            <li>ETLä»»åŠ¡ <i class="fas fa-sync-alt"></i></li>
            <li>æ•°æ®æºç®¡ç† <i class="fas fa-server"></i></li>
            <li>å…ƒæ•°æ®æµè§ˆ <i class="fas fa-table"></i></li>
            <li>æŠ½å–å†å² <i class="fas fa-history"></i></li>
            <li>ç”¨æˆ·ç®¡ç† <i class="fas fa-users"></i></li>
        </ol>
    </div>

    <div id="comparison" class="test-result info">
        <h3>æ­¥éª¤ 4ï¼šå¯¹æ¯”å„ä¸ªé¡µé¢</h3>
        <p>ç‚¹å‡»ä»¥ä¸‹é“¾æ¥ï¼Œæ£€æŸ¥æ¯ä¸ªé¡µé¢çš„å¯¼èˆªèœå•é¡ºåºæ˜¯å¦ä¸€è‡´ï¼š</p>
        <div class="d-flex gap-2 flex-wrap">
            <a href="/" target="_blank" class="btn btn-outline-primary">é¦–é¡µ</a>
            <a href="/dashboard" target="_blank" class="btn btn-outline-primary">èµ„æºæ¦‚è§ˆ</a>
            <a href="/etl" target="_blank" class="btn btn-outline-primary">ETLä»»åŠ¡</a>
            <a href="/data-sources" target="_blank" class="btn btn-outline-warning">æ•°æ®æºç®¡ç†</a>
            <a href="/metadata" target="_blank" class="btn btn-outline-primary">å…ƒæ•°æ®æµè§ˆ</a>
            <a href="/history" target="_blank" class="btn btn-outline-primary">æŠ½å–å†å²</a>
        </div>
    </div>

    <div id="testResults" class="test-result info">
        <h3>æ­¥éª¤ 5ï¼šæ£€æŸ¥æ˜¯å¦æœ‰åŠ¨æ€ä¿®æ”¹</h3>
        <p>æ£€æŸ¥æ˜¯å¦æœ‰JavaScriptä»£ç åŠ¨æ€ä¿®æ”¹å¯¼èˆªèœå•ï¼š</p>
        <div class="code">
            <pre id="jsCheckResult">æ£€æŸ¥ä¸­...</pre>
        </div>
    </div>

    <div class="test-result warning">
        <h3>ğŸ’¡ å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨</h3>
        <ul>
            <li>ç¦ç”¨æ‰€æœ‰æµè§ˆå™¨æ’ä»¶</li>
            <li>å°è¯•ä½¿ç”¨å…¶ä»–æµè§ˆå™¨ï¼ˆChromeã€Firefoxã€Edgeï¼‰</li>
            <li>æ£€æŸ¥æ˜¯å¦æœ‰ä»£ç†æˆ–VPNå¹²æ‰°</li>
            <li>æ¸…é™¤æ‰€æœ‰æµè§ˆæ•°æ®ï¼ˆCookieã€ç¼“å­˜ã€å†å²è®°å½•ï¼‰</li>
        </ul>
    </div>

    <script src="{{ url_for('static', filename='libs/bootstrap/js/bootstrap.bundle.min.js') }}"></script>
    <script>
        // æ£€æŸ¥å½“å‰å¯¼èˆªèœå•é¡ºåº
        function checkNavOrder() {
            const navMenu = document.getElementById('mainNavMenu');
            const navOrderList = document.getElementById('navOrderList');
            const items = navMenu.querySelectorAll('.nav-item');

            let html = '';
            items.forEach((item, index) => {
                const link = item.querySelector('.nav-link');
                const text = link.textContent.trim();
                const icon = link.querySelector('i');
                const iconClass = icon ? icon.className : '';
                const activeClass = link.classList.contains('active') ? ' <strong>[å½“å‰é¡µé¢]</strong>' : '';
                html += `<li>${index + 1}. ${text} <i class="${iconClass}"></i>${activeClass}</li>`;
            });

            navOrderList.innerHTML = html;

            // æ£€æŸ¥æ˜¯å¦æœ‰åŠ¨æ€ä¿®æ”¹
            checkDynamicModification();
        }

        // æ£€æŸ¥æ˜¯å¦æœ‰JavaScriptåŠ¨æ€ä¿®æ”¹
        function checkDynamicModification() {
            const resultDiv = document.getElementById('jsCheckResult');
            let warnings = [];

            // æ£€æŸ¥æ˜¯å¦æœ‰appendChildã€insertBeforeç­‰æ“ä½œ
            const scripts = document.querySelectorAll('script');
            scripts.forEach(script => {
                const content = script.textContent;
                if (content.includes('appendChild') ||
                    content.includes('insertBefore') ||
                    content.includes('mainNavMenu') ||
                    content.includes('innerHTML.*nav')) {
                    warnings.push('å‘ç°å¯èƒ½çš„åŠ¨æ€ä¿®æ”¹ä»£ç ');
                }
            });

            // æ£€æŸ¥CSS orderå±æ€§
            const styles = document.styleSheets;
            try {
                for (let i = 0; i < styles.length; i++) {
                    const rules = styles[i].cssRules || styles[i].rules;
                    for (let j = 0; j < rules.length; j++) {
                        if (rules[j].cssText.includes('order:') ||
                            rules[j].cssText.includes('flex-direction:')) {
                            warnings.push('CSSå¯èƒ½å½±å“é¡ºåº');
                            break;
                        }
                    }
                }
            } catch (e) {
                warnings.push('æ— æ³•æ£€æŸ¥CSSï¼ˆè·¨åŸŸé™åˆ¶ï¼‰');
            }

            if (warnings.length > 0) {
                resultDiv.innerHTML = warnings.join('\n');
            } else {
                resultDiv.innerHTML = 'æœªå‘ç°åŠ¨æ€ä¿®æ”¹ä»£ç ';
            }
        }

        // é¡µé¢åŠ è½½åæ£€æŸ¥
        window.addEventListener('load', checkNavOrder);
    </script>
</body>
</html>
